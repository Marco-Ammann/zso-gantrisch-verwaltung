<!-- src/app/modules/personen/notfallkontakte/notfallkontakte.component.html -->
<div class="notfallkontakte-container">
    <div class="header-section">
      <h1 class="page-title">Notfallkontakte</h1>
      
      @if (canEdit()) {
        <button 
          mat-raised-button 
          color="primary"
          (click)="openKontaktDialog()">
          <mat-icon>add</mat-icon>
          Neuer Notfallkontakt
        </button>
      }
    </div>
    
    @if (isLoading) {
      <div class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Daten werden geladen...</p>
      </div>
    } @else {
      <mat-card>
        <div class="table-container">
          <table mat-table [dataSource]="dataSource" class="notfallkontakte-table">
            <!-- Person -->
            <ng-container matColumnDef="person">
              <th mat-header-cell *matHeaderCellDef>Person</th>
              <td mat-cell *matCellDef="let kontakt">
                <a 
                  class="person-link" 
                  (click)="navigateToPerson(kontakt.personId)">
                  {{ getPersonName(kontakt.personId) }}
                </a>
              </td>
            </ng-container>
            
            <!-- Name -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let kontakt">{{ kontakt.name }}</td>
            </ng-container>
            
            <!-- Beziehung -->
            <ng-container matColumnDef="beziehung">
              <th mat-header-cell *matHeaderCellDef>Beziehung</th>
              <td mat-cell *matCellDef="let kontakt">{{ kontakt.beziehung }}</td>
            </ng-container>
            
            <!-- Telefonnummer -->
            <ng-container matColumnDef="telefonnummer">
              <th mat-header-cell *matHeaderCellDef>Telefonnummer</th>
              <td mat-cell *matCellDef="let kontakt">{{ kontakt.telefonnummer }}</td>
            </ng-container>
            
            <!-- Priorität -->
            <ng-container matColumnDef="prioritaet">
              <th mat-header-cell *matHeaderCellDef>Priorität</th>
              <td mat-cell *matCellDef="let kontakt">
                <span 
                  class="prioritaet-badge" 
                  [ngClass]="kontakt.prioritaet === 1 ? 'prio-1' : 'prio-2'">
                  {{ formatPrioritaet(kontakt.prioritaet) }}
                </span>
              </td>
            </ng-container>
            
            <!-- Aktionen -->
            <ng-container matColumnDef="aktionen">
              <th mat-header-cell *matHeaderCellDef>Aktionen</th>
              <td mat-cell *matCellDef="let kontakt">
                <div class="action-buttons">
                  @if (canEdit()) {
                    <button 
                      mat-icon-button 
                      color="primary"
                      matTooltip="Bearbeiten"
                      (click)="openKontaktDialog(kontakt)">
                      <mat-icon>edit</mat-icon>
                    </button>
                  }
                  
                  @if (canDelete()) {
                    <button 
                      mat-icon-button 
                      color="warn"
                      matTooltip="Löschen"
                      (click)="deleteKontakt(kontakt)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  }
                </div>
              </td>
            </ng-container>
            
            <!-- Tabellenzeilen -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            
            <!-- Leere Zeile wenn keine Daten -->
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell empty-row" [attr.colspan]="displayedColumns.length">
                <div class="no-data-message">
                  <mat-icon>info</mat-icon>
                  <span>Keine Notfallkontakte vorhanden</span>
                </div>
              </td>
            </tr>
          </table>
        </div>
        
        <!-- Paginierung -->
        <mat-paginator 
          [pageSizeOptions]="[10, 25, 50, 100]"
          showFirstLastButtons>
        </mat-paginator>
      </mat-card>
    }
  </div>